<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CHAT</title>
<style>
.title {
	text-align: center;
}

#room {
	height: 300px;
	background-color: lightgray;
	width: 400px;
	overflow-y:scroll;
}
</style>
</head>
<body>
	<h1 class="title">Chat Room</h1>
	<div id="room"></div>
	<div id="write">
		<textarea rows="6" cols="54" id="msg_content"></textarea>
		<span>Type "Enter" to send your message!</span>
	</div>
	<script>
		var ws = {};
		var roomDom = document.getElementById("room");
		var msg_contentDom = document.getElementById("msg_content");

		var name = prompt("Please enter your name", "");
		if (name && name != "null") {

			ws = new WebSocket("ws://localhost:9501");
			ws.onopen = function(e) {
				console.log("websocket open");
				var msg = new Object();
				msg.name = name;
				msg.cmd = "register";
				ws.send(JSON.stringify(msg));
			}
			ws.onmessage = function(e) {
				console.log(e.data);
				var msg = JSON.parse(e.data);
				var pDom=document.createElement("p");
				pDom.innerHTML=msg;
				roomDom.appendChild(pDom);

			}

			ws.onclose = function(e) {
				alert("您已退出聊天室");
			};

			ws.onerror = function(e) {
				alert("异常:" + e.data);
				console.log("onerror");
			};
			document.onkeydown = function(e) {
				var ev = document.all ? window.event : e;
				if (ev.keyCode == 13) {
					sendMsg();
				}
			}
		}

		function sendMsg() {
			var content = msg_contentDom.value;
			content = content.trim();
			if (!content) {
				return false;
			}

			var msg = new Object();
			msg.to = "All";
			msg.data = content;
			msg.cmd="";
			msg.from=name;
			ws.send(JSON.stringify(msg));
			msg_contentDom.value = "";
			return false;
		}
	</script>
</body>
</html>